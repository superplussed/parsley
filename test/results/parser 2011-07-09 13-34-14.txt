combined parser_definition and parser_state, more minor refactors

Thread ID: 2151955260
Total: 6.420969

 %self     total     self     wait    child    calls  name
 23.91      1.59     1.54     0.00     0.00        1  HandHistoryParser::BatchCollection#commit_batch
  9.53      0.76     0.61     0.00     0.15     7616  HandHistoryParser::ParserForActionState#filter_matches
  8.33      0.53     0.53     0.00     0.00    23331  HandHistoryParser::BatchCollection#set_field
  5.94      0.50     0.38     0.00     0.12    30271  HandHistoryParser::ParserForDefaultState#match_line
  5.63      1.75     0.36     0.00     1.39    17888  HandHistoryParser::ParserForDefaultState#insert_results
  5.23      0.35     0.34     0.00     0.02     1000  HandHistoryParser::BatchCollection#add_players_to_batch
  3.85      6.42     0.25     0.00     6.17        1  HandHistoryFile#read_from_file
  3.51      3.50     0.23     0.00     3.27    19888  HandHistoryParser::Reader#parse
  2.88      0.70     0.19     0.00     0.52    21501  HandHistoryParser::ParserForDefaultState#add_to_batch
  2.46      0.40     0.16     0.00     0.24    22655  HandHistoryParser::ParserState#update
  2.18      0.14     0.14     0.00     0.00    75625  HandHistoryParser::ParserState#name
  2.04      0.13     0.13     0.00     0.00    22884  HandHistoryFile#line_has_text?
  1.99      0.20     0.13     0.00     0.08    41683  HandHistoryParser::ParserState#get_state_definition
  1.86      0.12     0.12     0.00     0.00    34273  Regexp#match
  1.85      1.65     0.12     0.00     1.53    14179  HandHistoryParser::ParserForDefaultState#parse
  1.74      3.67     0.11     0.00     3.55    19888  HandHistoryParser::Reader#read
  1.61      0.20     0.10     0.00     0.10    19888  HandHistoryParser::ParserState#criteria_exists?
  1.60      1.47     0.10     0.00     1.37     8476  HandHistoryParser::ParserForActionState#parse
  1.35      0.15     0.09     0.00     0.06     2000  HandHistoryParser::Formatter::Formatter#format
  1.04      0.07     0.07     0.00     0.00     1000  HandHistoryParser::Formatter::Formatter#create_time_field
  0.97      0.06     0.06     0.00     0.00    22885  HandHistoryParser::ParserState#reset_matched
  0.78      0.75     0.05     0.00     0.70     2997  HandHistoryParser::BatchCollection#add_fields_to_batch
  0.74      0.20     0.05     0.00     0.16     6000  HandHistoryParser::ParserForSeatsState#filter_matches
  0.53      0.42     0.03     0.00     0.39    12414  HandHistoryParser::ParserForDefaultState#filter_matches
  0.53      0.09     0.03     0.00     0.05     1124  HandHistoryParser::ParserForSummaryState#filter_matches
  0.53      0.03     0.03     0.00     0.00     1000  HandHistoryParser::Formatter::Formatter#prepend_site_id
  0.52      0.06     0.03     0.00     0.02     1000  HandHistoryParser::Reader#initialize_site
  0.51      0.03     0.03     0.00     0.00     1000  HandHistoryParser::Formatter::PstFormatter#game_type
  0.51      0.03     0.03     0.00     0.00     3009  HandHistoryParser::ParserForDefaultState#format_money
  0.49      0.03     0.03     0.00     0.00     4997  HandHistoryParser::BatchCollection#get_field
  0.49      0.03     0.03     0.00     0.00     1000  HandHistoryParser::ParserState#state=
  0.40      0.29     0.03     0.00     0.26     1000  HandHistoryParser::Formatter::Formatter#initialize
  0.38      0.04     0.02     0.00     0.02     8476  HandHistoryParser::ParserState#get_next_regex
  0.38      0.06     0.02     0.00     0.04    11287  HandHistoryParser::Reader#match_to_summary_header
  0.35      0.04     0.02     0.00     0.01     1997  HandHistoryParser::BatchCollection#log_error
  0.34      0.02     0.02     0.00     0.00    11720  HandHistoryParser::ParserState#next
  0.33      0.06     0.02     0.00     0.04     2997  HandHistoryParser::BatchCollection#valid_hand?
  0.31      0.02     0.02     0.00     0.00     4257  HandHistoryParser::ParserForDefaultState#format_seat
  0.30      0.79     0.02     0.00     0.77     2997  HandHistoryParser::Reader#end_hand
  0.25      0.02     0.02     0.00     0.00     8476  HandHistoryParser::ParserState#next_state_name
  0.17      0.02     0.01     0.00     0.01     2997  HandHistoryParser::ParserState#reset_current
  0.17      0.01     0.01     0.00     0.00     1000  HandHistoryParser::Formatter::Formatter#count_seated
  0.11      0.01     0.01     0.00     0.00     1000  HandHistoryParser::Formatter::Formatter#table_type
  0.11      0.01     0.01     0.00     0.00     1000  HandHistoryParser::Formatter::Formatter#max_bb
  0.11      0.01     0.01     0.00     0.00     1000  HandHistoryParser::Formatter::Formatter#cash_game
  0.10      0.01     0.01     0.00     0.00     1000  HandHistoryParser::Formatter::PstFormatter#table_max
  0.07      0.09     0.00     0.00     0.09     1124  HandHistoryParser::ParserForSummaryState#insert_results
  0.06      0.04     0.00     0.00     0.03     1000  HandHistoryParser::ParserState#go_to_summary
  0.06      0.00     0.00     0.00     0.00     1000  HandHistoryParser::Formatter::Formatter#currency
  0.04      0.00     0.00     0.00     0.00        1  HandHistoryParser::ParserState#load_json
  0.01      0.00     0.00     0.00     0.00        1  HandHistoryParser::ParserState#convert_match_attributes_to_symbol
  0.00      0.00     0.00     0.00     0.00       25  Regexp#initialize
  0.00      0.00     0.00     0.00     0.00        1  Site#get_file_name
  0.00      0.00     0.00     0.00     0.00        2  File#initialize
  0.00      0.00     0.00     0.00     0.00        2  ConditionVariable#signal
  0.00      0.00     0.00     0.00     0.00        1  HandHistoryParser::ParserState#begin_state_index
  0.00      0.00     0.00     0.00     0.00        2  Site#fields
  0.00      0.00     0.00     0.00     0.00        1  HandHistoryParser::ParserState#build_states_list
  0.00      0.00     0.00     0.00     0.00        1  HandHistoryParser::ParserState#load_definitions
  0.00      0.00     0.00     0.00     0.00        1  HandHistoryParser::ParserState#end_state_index
  0.00      0.00     0.00     0.00     0.00        1  HandHistoryParser::ParserForActionState#load_definitions
  0.00      1.59     0.00     0.00     1.59        1  HandHistoryParser::Reader#commit_batch
  0.00      0.00     0.00     0.00     0.00        1  HandHistoryFile#full_path
  0.00      0.00     0.00     0.00     0.00        3  HandHistoryParser::ParserState#get_root_definition
  0.00      0.00     0.00     0.00     0.00        1  HandHistoryFile#get_access_string
  0.00      0.00     0.00     0.00     0.00        1  Thread#[]